<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sistema de Treinos Personalizados</title>
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="JS Fit Personal">
    <title>JS Fit App - Criador de Planos de Treino</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0iIzc5NDVmZiIvPgo8cGF0aCBkPSJtMTYgOGMtNC40MTggMC04IDMuNTgyLTggOHY4YzAgNC40MTggMy41ODIgOCA4IDhzOC0zLjU4MiA4LTh2LThjMC00LjQxOC0zLjU4Mi04LTgtOHoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==">
    <link rel="stylesheet" href="css/stylePersonal.css">
    
 
        
</head>

<body>


<div id="authContainer" class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h1>üèãÔ∏è JS Fit Personal</h1>
            <p>Sistema de Cria√ß√£o de Planos de Treino</p>
        </div>
        
        <div id="loginForm" class="auth-form">
            <h2>Login</h2>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="loginEmail" class="form-input" placeholder="seu@email.com">
            </div>
            <div class="form-group">
                <label>Senha</label>
                <input type="password" id="loginPassword" class="form-input" placeholder="Digite sua senha">
            </div>
            <button class="btn btn-primary btn-full" onclick="authManager.login()">
                Entrar
            </button>
            <button class="btn btn-link btn-full" onclick="authManager.showPasswordReset()">
                Esqueci minha senha
            </button>
        </div>
        
        <div id="registerForm" class="auth-form" style="display: none;">
            <h2>Criar Conta</h2>
            <div class="form-group">
                <label>Nome Completo</label>
                <input type="text" id="registerName" class="form-input" placeholder="Seu nome completo">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="registerEmail" class="form-input" placeholder="seu@email.com">
            </div>
            <div class="form-group">
                <label>Senha</label>
                <input type="password" id="registerPassword" class="form-input" placeholder="M√≠nimo 6 caracteres">
            </div>
            <div class="form-group">
                <label>Confirmar Senha</label>
                <input type="password" id="registerPasswordConfirm" class="form-input" placeholder="Confirme sua senha">
            </div>
            <button class="btn btn-primary btn-full" onclick="authManager.register()">
                Criar Conta
            </button>
            <button class="btn btn-outline btn-full" onclick="authManager.showLogin()">
                J√° tenho conta
            </button>
        </div>
        
        <div id="passwordResetForm" class="auth-form" style="display: none;">
            <h2>Recuperar Senha</h2>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="resetEmail" class="form-input" placeholder="seu@email.com">
            </div>
            <button class="btn btn-primary btn-full" onclick="authManager.resetPassword()">
                Enviar Link de Recupera√ß√£o
            </button>
            <button class="btn btn-outline btn-full" onclick="authManager.showLogin()">
                Voltar ao Login
            </button>
        </div>
    </div>
</div>

    <div class="container">
        <header class="header">
            <h1>üèãÔ∏è JS Fit App</h1>
            <p>Criador de Planos de Treino Personalizados</p>
            <div class="developer-info">
                <div class="developer-name">
                    <svg class="developer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    Desenvolvido por Javan Santana
                </div>
                <div class="developer-contact">
                    <svg class="phone-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                    </svg>
                    (15) 99143-7433
                </div>
            </div>

            <div class="main-actions">
                <button class="btn btn-primary" onclick="app.showPlanCreator()">
                    ‚ûï Novo Plano
                </button>
                <button class="btn btn-secondary" onclick="app.showPlanList()">
                    üìã Meus Planos
                </button>
                <button class="btn btn-ai" onclick="app.showAIPlanCreator()">
                    ü§ñ Criar com IA
                </button>
                <label class="btn btn-outline" for="importFile">
                    üìÇ Importar Plano
                </label>
            </div>
        </header>

        <!-- AI Plan Creator -->
        <div id="aiPlanCreator" class="content-card" style="display: none;">
            <div class="ai-form-section">
                <h3>ü§ñ Criador de Plano com IA</h3>
                <p>Preencha as informa√ß√µes b√°sicas e deixe a IA criar um plano personalizado para voc√™!</p>
            </div>

            <div class="form-section">
                <h2>üë§ Dados do Aluno</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome do Aluno</label>
                        <input type="text" id="aiStudentName" class="form-input" placeholder="Digite o nome completo">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" id="aiStudentBirthDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CPF (opcional)</label>
                        <input type="text" id="aiStudentCpf" class="form-input" placeholder="000.000.000-00" maxlength="14">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Altura</label>
                        <input type="text" id="aiStudentHeight" class="form-input" placeholder="1,75m">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso</label>
                        <input type="text" id="aiStudentWeight" class="form-input" placeholder="75kg">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>üéØ Configura√ß√µes do Plano</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Objetivo Principal</label>
                        <select id="aiPlanObjective" class="form-select">
                            <option value="Hipertrofia e ganho de massa muscular">Hipertrofia e ganho de massa muscular</option>
                            <option value="Perda de peso e defini√ß√£o">Perda de peso e defini√ß√£o</option>
                            <option value="Condicionamento geral">Condicionamento geral</option>
                            <option value="For√ßa e pot√™ncia">For√ßa e pot√™ncia</option>
                            <option value="Resist√™ncia muscular">Resist√™ncia muscular</option>
                            <option value="Reabilita√ß√£o">Reabilita√ß√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">N√≠vel de Experi√™ncia</label>
                        <select id="aiExperienceLevel" class="form-select">
                            <option value="iniciante">Iniciante (0-6 meses)</option>
                            <option value="intermediario">Intermedi√°rio (6 meses - 2 anos)</option>
                            <option value="avancado">Avan√ßado (2+ anos)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dias Dispon√≠veis por Semana</label>
                        <select id="aiAvailableDays" class="form-select">
                            <option value="2">2 dias</option>
                            <option value="3" selected>3 dias</option>
                            <option value="4">4 dias</option>
                            <option value="5">5 dias</option>
                            <option value="6">6 dias</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tempo por Sess√£o (minutos)</label>
                        <select id="aiSessionTime" class="form-select">
                            <option value="45">45 minutos</option>
                            <option value="60" selected>60 minutos</option>
                            <option value="75">75 minutos</option>
                            <option value="90">90 minutos</option>
                        </select>
                    </div>
                </div>

            </div>
            <div class="form-section">
                <h2>‚öôÔ∏è Configura√ß√£o de Grupos Musculares</h2>
                <div class="form-group">
                    <label class="form-label">
                        Personalizar quais m√∫sculos trabalhar em cada dia de treino
                    </label>
                    <div class="muscle-config-toggle">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="aiUseCustomMuscleConfig" 
                                   onchange="app.toggleAIMuscleConfig()">
                            <span>üéØ Ativar configura√ß√£o personalizada de m√∫sculos</span>
                        </label>
                    </div>
                </div>

                <div id="aiMuscleConfigSection" class="muscle-config-section" style="display: none;">
                    <div class="config-header">
                        <h3>üèãÔ∏è Configure seus Treinos</h3>
                        <p>Selecione quais grupos musculares trabalhar em cada dia:</p>
                    </div>
                    
                    <div id="aiWorkoutConfigGrid" class="workout-config-grid">
                        <!-- Ser√° preenchido dinamicamente pelo JavaScript -->
                    </div>
                    
                    <div class="config-actions">
                        <button type="button" class="btn btn-secondary btn-small" 
                                onclick="app.loadAIPresetConfig()">
                            üìã Usar Configura√ß√£o Padr√£o
                        </button>
                        <button type="button" class="btn btn-outline btn-small" 
                                onclick="app.resetAIMuscleConfig()">
                            üîÑ Limpar Tudo
                        </button>
                    </div>
                </div>
            </div>


            <div class="form-section">
                <h2>üèãÔ∏è Prefer√™ncias de Treino</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Equipamentos Dispon√≠veis</label>
                        <select id="aiEquipment" class="form-select">
                            <option value="academia_completa">Academia Completa</option>
                            <option value="home_gym">Home Gym (Halteres + Barra)</option>
                            <option value="peso_corporal">Apenas Peso Corporal</option>
                            <option value="funcional">Equipamentos Funcionais</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Foco Muscular Preferido</label>
                        <select id="aiMusclePreference" class="form-select">
                            <option value="equilibrado">Desenvolvimento Equilibrado</option>
                            <option value="superior">Foco Membros Superiores</option>
                            <option value="inferior">Foco Membros Inferiores</option>
                            <option value="core">Foco Core e Funcional</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Limita√ß√µes ou Les√µes</label>
                    <textarea id="aiLimitations" class="form-textarea" placeholder="Descreva qualquer limita√ß√£o f√≠sica, les√£o pr√©via ou exerc√≠cio que deve ser evitado..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Observa√ß√µes Especiais</label>
                    <textarea id="aiSpecialNotes" class="form-textarea" placeholder="Exerc√≠cios preferidos, hor√°rios de treino, metas espec√≠ficas, etc..."></textarea>
                </div>
            </div>

            <div class="generating-indicator" id="generatingIndicator">
                <div class="spinner"></div>
                <h3>ü§ñ IA Criando Seu Plano...</h3>
                <p>Analisando suas informa√ß√µes e gerando o plano personalizado. Isso pode levar alguns segundos.</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-ai" onclick="app.generateAIPlan()">
                    ü§ñ Gerar Plano com IA
                </button>
                <button class="btn btn-outline" onclick="app.showPlanList()">
                    üìã Ver Meus Planos
                </button>
            </div>
        </div>

        <!-- Manual Plan Creator -->
        <div id="planCreator" class="content-card" style="display: none;">
            <input type="hidden" id="currentPlanId" value="">
            <div class="form-section">
                <h2>üë§ Dados do Aluno</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome do Aluno</label>
                        <input type="text" id="studentName" class="form-input" placeholder="Digite o nome completo">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" id="studentBirthDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CPF (opcional)</label>
                        <input type="text" id="studentCpf" class="form-input" placeholder="000.000.000-00" maxlength="14">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Altura</label>
                        <input type="text" id="studentHeight" class="form-input" placeholder="1,75m">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso</label>
                        <input type="text" id="studentWeight" class="form-input" placeholder="75kg">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>üéØ Configura√ß√µes do Plano</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome do Plano</label>
                        <input type="text" id="planName" class="form-input" placeholder="Plano Hipertrofia 2024">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Objetivo</label>
                        <select id="planObjective" class="form-select">
                            <option value="Hipertrofia e ganho de massa muscular">Hipertrofia e ganho de massa muscular</option>
                            <option value="Condicionamento geral">Condicionamento geral</option>
                            <option value="Perda de peso">Perda de peso</option>
                            <option value="Defini√ß√£o muscular">Defini√ß√£o muscular</option>
                            <option value="For√ßa">Ganho de for√ßa</option>
                            <option value="Resist√™ncia">Resist√™ncia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de In√≠cio</label>
                        <input type="date" id="planStartDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Fim</label>
                        <input type="date" id="planEndDate" class="form-input">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes Gerais</label>
                    <textarea id="planObservations" class="form-textarea" placeholder="Digite observa√ß√µes importantes sobre o plano de treino..."></textarea>
                </div>
            </div>

<!-- Se√ß√£o de Tipo de Plano Atualizada -->
<!-- Se√ß√£o de Tipo de Plano Atualizada -->
<div class="form-section">
    <h2>üìÖ Tipo de Plano</h2>
    <p class="form-hint">
        <span>Selecione quantos dias de treino deseja e configure os grupos musculares para cada treino</span>
    </p>
    
    <div class="plan-type-selector" id="planTypeSelector">
        <div class="plan-type-btn active" onclick="app.selectPlanType(1, 'A', this)">
            <div style="font-size: 1.2rem; margin-bottom: 5px;">A</div>
            <div style="font-size: 0.9rem;">1 Dia</div>
            <div class="plan-configured-indicator" style="display: none;"></div>
        </div>
        <div class="plan-type-btn" onclick="app.selectPlanType(2, 'AB', this)">
            <div style="font-size: 1.2rem; margin-bottom: 5px;">AB</div>
            <div style="font-size: 0.9rem;">2 Dias</div>
            <div class="plan-configured-indicator" style="display: none;"></div>
        </div>
        <div class="plan-type-btn" onclick="app.selectPlanType(3, 'ABC', this)">
            <div style="font-size: 1.2rem; margin-bottom: 5px;">ABC</div>
            <div style="font-size: 0.9rem;">3 Dias</div>
            <div class="plan-configured-indicator" style="display: none;"></div>
        </div>
        <div class="plan-type-btn" onclick="app.selectPlanType(4, 'ABCD', this)">
            <div style="font-size: 1.2rem; margin-bottom: 5px;">ABCD</div>
            <div style="font-size: 0.9rem;">4 Dias</div>
            <div class="plan-configured-indicator" style="display: none;"></div>
        </div>
        <div class="plan-type-btn" onclick="app.selectPlanType(5, 'ABCDE', this)">
            <div style="font-size: 1.2rem; margin-bottom: 5px;">ABCDE</div>
            <div style="font-size: 0.9rem;">5 Dias</div>
            <div class="plan-configured-indicator" style="display: none;"></div>
        </div>
        <div class="plan-type-btn" onclick="app.selectPlanType(6, 'ABCDEF', this)">
            <div style="font-size: 1.2rem; margin-bottom: 5px;">ABCDEF</div>
            <div style="font-size: 0.9rem;">6 Dias</div>
            <div class="plan-configured-indicator" style="display: none;"></div>
        </div>
    </div>
    
    <!-- NOVA SE√á√ÉO: Configura√ß√£o Inline Expans√≠vel -->
    <div id="inlineQuickConfig" class="inline-quick-config" style="display: none;">
        <div class="inline-config-header">
            <h3>‚öôÔ∏è Configurar Grupos Musculares</h3>
            <button class="inline-config-close" onclick="app.closeInlineQuickConfig()">‚úï</button>
        </div>
        
        <div class="alert alert-info">
            <strong>üí° Configure rapidamente:</strong> Selecione os grupos musculares que cada treino deve trabalhar.
        </div>
        
        <div id="inlineQuickConfigContent" class="inline-config-content">
            <!-- Conte√∫do ser√° gerado dinamicamente -->
        </div>
        
        <div class="inline-config-actions">
            <button class="btn btn-primary" onclick="app.saveInlineQuickConfig()">
                ‚úÖ Aplicar Configura√ß√£o
            </button>
            <button class="btn btn-secondary" onclick="app.loadInlinePresetConfig()">
                üìã Usar Padr√£o
            </button>
            <button class="btn btn-outline" onclick="app.closeInlineQuickConfig()">
                ‚ùå Cancelar
            </button>
        </div>
    </div>
    
    <!-- Status da configura√ß√£o -->
    <div class="plan-config-actions" style="text-align: center; margin-top: 15px;">
        <button class="btn btn-secondary btn-small" onclick="app.showInlineQuickConfig()" style="display: none;" id="advancedConfigBtn">
            ‚öôÔ∏è Configura√ß√£o Avan√ßada
        </button>
        <div class="form-hint" id="planConfigStatus">
            <span>üí° Clique em um tipo de plano para configurar os grupos musculares</span>
        </div>
    </div>
</div>

            <div id="workoutEditor">
                <!-- Workouts will be generated here -->
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="app.savePlan()">
                    üíæ Salvar Plano
                </button>
                <button class="btn btn-outline" onclick="app.showPlanList()">
                    üìã Ver Meus Planos
                </button>
                <button class="btn btn-danger" onclick="app.cancelEdit()" style="display: none;" id="cancelEditBtn">
                    ‚ùå Cancelar Edi√ß√£o
                </button>
            </div>
        </div>

        <!-- Plan List -->
        <div id="planList" class="content-card">
            <h2>üìã Meus Planos de Treino</h2>
            <div id="planListContent">
                <div class="plan-card">
                    <h3>Para ver seus planos de treino, clique em 'Mostrar Planos' </h3>
                    <p>Crie seu plano de treino clicando em "Novo Plano" ou "Criar com IA"!</p>
                </div>
            </div>
        </div>
        <div id="planDetails" class="content-card" style="display: none;">
            <div class="plan-details-header">
                <button class="btn btn-outline btn-small" onclick="app.backToPlanList()">
                    ‚Üê Voltar
                </button>
                <h2 id="planDetailsTitle">Detalhes do Plano</h2>
            </div>
            <div id="planDetailsContent">
                <!-- Plan details will be loaded here -->
            </div>
        </div>
        
    </div>

    <!-- Loading Global da Aplica√ß√£o -->
<div id="globalLoadingOverlay" class="loading-overlay">
    <div class="loading-container">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
        </div>
        <div class="loading-content">
            <h3 id="loadingTitle">Carregando...</h3>
            <p id="loadingMessage">Inicializando aplica√ß√£o...</p>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="loadingProgress"></div>
                </div>
                <span class="progress-text" id="loadingPercentage">0%</span>
            </div>
        </div>
    </div>
</div>

    <!-- ADICIONAR ESTE HTML NA SE√á√ÉO DE CONTROLES DA SUA INTERFACE -->



<!-- Controles de Debug e Sincroniza√ß√£o -->
<div class="debug-controls" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
    <div class="debug-panel" id="debugPanel" style="display: none;">
        <div class="debug-header">
            <h4>Controles de Debug</h4>
            <button onclick="app.toggleDebugPanel()" class="close-debug">&times;</button>
        </div>
        <div class="debug-actions">
            <button class="btn btn-sm btn-outline" onclick="app.debugDataState()">
                Estado dos Dados
            </button>
            <button class="btn btn-sm btn-primary" onclick="app.reloadData()">
                Recarregar Dados
            </button>
            <button class="btn btn-sm btn-success" onclick="app.forceSyncAllPlans()">
                For√ßar Sync Firebase
            </button>
            <button class="btn btn-sm btn-warning" onclick="app.createEmergencyBackup()">
                Backup Emerg√™ncia
            </button>
            <button class="btn btn-sm btn-info" onclick="app.verifyAndRestorePlans()">
                Restaurar Planos
            </button>
            <button class="btn btn-sm btn-secondary" onclick="app.syncAllPendingOperations()">
                Sync Firebase
            </button>
            <div class="debug-info">
                <small>
                    Total: <span id="debugPlanCount">0</span> | 
                    Firebase: <span id="debugFirebaseCount">0</span> | 
                    Pendentes: <span id="debugPendingCount">0</span>
                </small>
                <div class="sync-status-bar">
                    <div class="sync-progress" id="syncProgressBar"></div>
                </div>
                <small id="syncStatus" class="sync-status"></small>
            </div>
        </div>
    </div>
    
    <!-- Bot√£o para mostrar/ocultar painel -->
    <button class="btn btn-debug" onclick="app.toggleDebugPanel()" title="Debug Controls">
        üîß
    </button>
</div>



<!-- Hidden file input -->
<input type="file" id="importFile" style="display: none;" accept=".json" onchange="app.importPlan(event)">

<!-- Ordem OBRIGAT√ìRIA no personal.html -->
<script src="js/shared/jsfitcore.js" defer></script>
<script src="js/auth.js" defer></script>

<script src="js/shared/coremanager.js"></script>
<script src="js/ImprovedAIPlanGenerator.js"></script>  
<script src="js/personal.js"></script>

<script>
    // INICIALIZA√á√ÉO √öNICA COM COREMANAGER
(function() {
    let appInitialized = false;
    
    async function initializeApp() {
        if (appInitialized) {
            console.log('‚ö†Ô∏è App j√° foi inicializado, ignorando nova tentativa');
            return;
        }
        
        console.log('üöÄ Iniciando aplica√ß√£o √∫nica...');
        appInitialized = true;
        
        try {
            
            // 2. OBTER CORE VIA COREMANAGER
            let core = null;
            try {
                console.log('üîß Obtendo core via CoreManager...');
                core = await window.coreManager.getCore();
                console.log('‚úÖ Core obtido com sucesso:', !!core);
            } catch (coreError) {
                console.warn('‚ö†Ô∏è Erro ao obter core:', coreError.message);
                // Criar core de emerg√™ncia se necess√°rio
                core = window.coreManager.createSafeCore();
            }
            
            // 3. DISPONIBILIZAR CORE GLOBALMENTE PARA COMPATIBILIDADE
            if (core) {
                window.Core = core;
                window.globalCore = core;
                console.log('‚úÖ Core disponibilizado globalmente');
            }
            
            // 4. CRIAR PERSONALAPP COM CORE DISPON√çVEL
            if (!window.app) {
                window.app = new PersonalApp();
                console.log('‚úÖ PersonalApp criado');
            }
            
            // 5. GARANTIR QUE O APP TEM ACESSO AO CORE
            if (window.app && core) {
                // Se o app n√£o tem core, fornecer via CoreManager
                if (!window.app.core) {
                    console.log('üîß Fornecendo core para PersonalApp...');
                    window.app.core = core;
                }
            }
            
            // 6. INICIALIZAR PERSONALAPP
            
            console.log('‚úÖ Aplica√ß√£o inicializada com CoreManager');
            
        } catch (error) {
            console.error('‚ùå Erro na inicializa√ß√£o:', error);
            appInitialized = false;
            
            // FALLBACK: Core de emerg√™ncia
            try {
                console.log('üÜò Tentando fallback com core de emerg√™ncia...');
                
                if (!window.Core) {
                    window.Core = {
                        formatDate: (dateStr) => {
                            try {
                                return new Date(dateStr).toLocaleDateString('pt-BR');
                            } catch {
                                return 'Data inv√°lida';
                            }
                        },
                        showNotification: (msg, type) => console.log(`${type}: ${msg}`),
                        generateId: () => Date.now().toString() + Math.random().toString(36).substr(2, 9),
                        firebaseConnected: false,
                        isEmergencyCore: true
                    };
                }
                
                if (!window.app && typeof PersonalApp === 'function') {
                    window.app = new PersonalApp();
                    if (window.app && !window.app.core) {
                        window.app.core = window.Core;
                    }
                }
                
                console.log('‚úÖ Fallback aplicado');
                
            } catch (fallbackError) {
                console.error('üí• Erro no fallback:', fallbackError);
            }
        }
    }
    
    // AGUARDAR DEPEND√äNCIAS
    function waitForDependencies() {
        return new Promise((resolve) => {
            let attempts = 0;
            const maxAttempts = 50;
            
            const checkDependencies = () => {
                attempts++;
                
                const hasPersonalApp = typeof PersonalApp === 'function';
                const hasCoreManager = typeof CoreManager === 'function' || !!window.coreManager;
                const domReady = document.readyState === 'complete' || document.readyState === 'interactive';
                
                if (hasPersonalApp && hasCoreManager && domReady) {
                    console.log('‚úÖ Depend√™ncias prontas (PersonalApp + CoreManager + DOM)');
                    resolve();
                } else if (attempts >= maxAttempts) {
                    console.warn('‚è∞ Timeout nas depend√™ncias, for√ßando inicializa√ß√£o...');
                    console.log('Estado:', { PersonalApp: hasPersonalApp, CoreManager: hasCoreManager, DOM: domReady });
                    resolve();
                } else {
                    if (attempts % 10 === 0) {
                        console.log(`‚è≥ Aguardando depend√™ncias... (${attempts/10}s)`);
                    }
                    setTimeout(checkDependencies, 100);
                }
            };
            
            checkDependencies();
        });
    }
    
    // INICIALIZAR QUANDO PRONTO
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', async () => {
            await waitForDependencies();
            await initializeApp();
        });
    } else {
        waitForDependencies().then(initializeApp);
    }
})();
</script>

</body>


</html>